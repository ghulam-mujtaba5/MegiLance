domains:
- domain: www.megilance.site
  type: PRIMARY
  zone: megilance.site
- domain: api.megilance.site
  type: ALIAS
  zone: megilance.site
ingress:
  rules:
  - component:
      name: backend
      preserve_path_prefix: true
    match:
      path:
        prefix: /api
  - component:
      name: backend
      preserve_path_prefix: true
    match:
      path:
        prefix: /backend
  - component:
      name: frontend
    match:
      path:
        prefix: /
name: megilance
region: blr
services:
- dockerfile_path: backend/Dockerfile
  envs:
  - key: DATABASE_URL
    scope: RUN_AND_BUILD_TIME
    value: sqlite:///./local.db
  - key: TURSO_DATABASE_URL
    scope: RUN_TIME
    value: libsql://megilance-db-megilance.aws-ap-south-1.turso.io
  - key: TURSO_AUTH_TOKEN
    scope: RUN_TIME
    value: eyJhbGciOiJFZERTQSIsInR5cCI6IkpXVCJ9.eyJpYXQiOjE3NjM5MjA2NTcsImlkIjoiZGVmMGE2NzYtMGZiNC00MDAzLTkyNmItMDhlYzA4NjY4MWFkIiwicmlkIjoiYTliOGUwMzctZGQwNi00NTRiLTlmYzgtNGFmMzcxYTg0ODdiIn0.DbIrBHumR_y96cNkQGoUEwyeCqXQuM7y7hWm0UFWluRmIAgb2tGf-lExHqrkAspA_pmSp1tVjELrxw0dmxfgCQ
  - key: SECRET_KEY
    scope: RUN_TIME
    value: megilance_production_2024_secure_key_change_me
  - key: ENVIRONMENT
    scope: RUN_TIME
    value: production
  - key: CORS_ORIGINS
    scope: RUN_TIME
    value: https://megilance.site,https://www.megilance.site,https://api.megilance.site
  - key: BACKEND_CORS_ORIGINS
    scope: RUN_TIME
    value: '["https://megilance.site","https://www.megilance.site"]'
  - key: SLOWAPI_ENABLED
    scope: RUN_TIME
    value: "true"
  - key: AI_SERVICE_URL
    scope: RUN_TIME
    value: http://ai-service:8001
  github:
    branch: main
    deploy_on_push: true
    repo: Mwaqarulmulk/MegiLance
  health_check:
    failure_threshold: 5
    http_path: /api/health/live
    initial_delay_seconds: 120
    period_seconds: 30
    success_threshold: 1
    timeout_seconds: 30
  http_port: 8000
  instance_count: 1
  instance_size_slug: basic-s
  name: backend
- dockerfile_path: ai/Dockerfile
  envs:
  - key: PORT
    scope: RUN_TIME
    value: "8001"
  - key: ML_WORKERS
    scope: RUN_TIME
    value: "1"
  - key: CORS_ORIGINS
    scope: RUN_TIME
    value: "*"
  github:
    branch: main
    deploy_on_push: true
    repo: Mwaqarulmulk/MegiLance
  health_check:
    failure_threshold: 5
    http_path: /health
    initial_delay_seconds: 120
    period_seconds: 30
    success_threshold: 1
    timeout_seconds: 10
  http_port: 8001
  instance_count: 1
  instance_size_slug: basic-s
  name: ai-service
- dockerfile_path: frontend/Dockerfile
  envs:
  - key: NODE_ENV
    scope: RUN_AND_BUILD_TIME
    value: production
  - key: NEXT_TELEMETRY_DISABLED
    scope: RUN_AND_BUILD_TIME
    value: "1"
  - key: NEXT_PUBLIC_BACKEND_URL
    scope: RUN_AND_BUILD_TIME
    value: https://megilance.site
  - key: NEXT_PUBLIC_API_URL
    scope: RUN_AND_BUILD_TIME
    value: https://megilance.site/api
  github:
    branch: main
    deploy_on_push: true
    repo: Mwaqarulmulk/MegiLance
  health_check:
    failure_threshold: 5
    http_path: /
    initial_delay_seconds: 60
    period_seconds: 30
    success_threshold: 1
    timeout_seconds: 10
  http_port: 3000
  instance_count: 1
  instance_size_slug: basic-xs
  name: frontend

